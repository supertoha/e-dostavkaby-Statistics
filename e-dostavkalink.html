<a href="javascript:async function getData(a){return $.ajax({url:a,type:'GET'})}async function getProductInfo(a,b){const c=await getData(a);return{url:a,category:$('.breadcrumbs',c).children('a').eq(2).text(),id:b,price:$('.price meta',c).attr('content')}}async function buildMoneyPerMonthChart(b){const c=['\u042F\u043D\u0432\u0430\u0440\u044C','\u0424\u0435\u0432\u0440\u0430\u043B\u044C','\u041C\u0430\u0440\u0442','\u0410\u043F\u0440\u0435\u043B\u044C','\u041C\u0430\u0439','\u0418\u044E\u043D\u044C','\u0418\u044E\u043B\u044C','\u0410\u0432\u0433\u0443\u0441\u0442','\u0421\u0435\u043D\u0442\u044F\u0431\u0440\u044C','\u041E\u043A\u0442\u044F\u0431\u0440\u044C','\u041D\u043E\u044F\u0431\u0440\u044C','\u0414\u0435\u043A\u0430\u0431\u0440\u044C'];let f=new Date(-864e13),g=new Date(864e13);for(let a=0;a<b.length;a++)b[a].date>=f&&(f=b[a].date),b[a].date<=g&&(g=b[a].date);var h=f.getMonth()+12*f.getFullYear()-(g.getMonth()+12*g.getFullYear()),j=[];for(let a=0;a<=h;a++){var k=new Date(g.getFullYear(),g.getMonth()+a,1),m=0;for(let a=0;a<b.length;a++)b[a].date.getMonth()===k.getMonth()&&b[a].date.getFullYear()===k.getFullYear()&&(m+=b[a].price);var n=c[k.getMonth()]+' '+k.getFullYear().toString();j.push({label:n,y:m})}$('#chartContainer').CanvasJSChart({animationEnabled:!0,title:{text:'\u0420\u0430\u0441\u0445\u043E\u0434\u044B \u0432 \u043C\u0435\u0441\u044F\u0446'},axisY:{title:'\u0440\u0430\u0441\u0445\u043E\u0434\u044B',suffix:'\u0440',includeZero:!1},axisX:{title:'\u041C\u0435\u0441\u044F\u0446\u044B'},data:[{type:'column',dataPoints:j}]})}function buildPriceChangeChart(b,f){var e=[],g=0;for(const a of f){var h=[],i=-1/0,j=1/0,k='';for(const c of b)if(a.id===c.id){if(!isNaN(parseFloat(a.price))&&0===h.length){var m=parseFloat(a.price)/c.quantity;h.push({y:m,x:new Date})}k=c.title;var l=c.price/c.quantity;h.push({y:l,x:c.date}),l<=j&&(j=l),l>=i&&(i=l)}var d=(i-j)/i;d>=g&&(g=d),e.push({label:k+' \u0430\u0440\u0442. '+a.id,name:k,points:h,priceChangeRate:d})}var c=e.find(a=>a.priceChangeRate===g);$('#productDropDown').autocomplete({source:e,minLength:2,focus:function(){return!1},select:function(a,b){return $('#productDropDown').val(b.item.name),drawPriceChangeChart(b.item.points,b.item.name),!1}}),$('#productDropDown').val(c.name),$('#productDropDown').dblclick(function(){$('#productDropDown').val('')}),drawPriceChangeChart(c.points,c.name)}function drawPriceChangeChart(a,b){$('#priceChangeChartContainer').CanvasJSChart({animationEnabled:!0,theme:'light2',title:{text:'\u0414\u0438\u043D\u0430\u043C\u0438\u043A\u0430 \u0446\u0435\u043D\u044B \u0442\u043E\u0432\u0430\u0440\u0430'},axisX:{valueFormatString:'DD MMM'},axisY:{title:'\u0426\u0435\u043D\u0430 \u0442\u043E\u0432\u0430\u0440\u0430, \u0440',suffix:'\u0440',minimum:0},toolTip:{shared:!0},legend:{cursor:'pointer',verticalAlign:'bottom',horizontalAlign:'left',dockInsidePlotArea:!0},data:[{type:'line',showInLegend:!0,name:b,markerType:'square',xValueFormatString:'DD MMM, YYYY',color:'#F08080',yValueFormatString:'0.00',dataPoints:a}]})}function findCategory(a,b){for(let c=0;c<a.length;c++)if(a[c].url===b)return a[c].category}function buildMoneyPerCategory(b,c){var d=[],e=0;for(let a=0;a<b.length;a++){var f=b[a];if(!isNullOrEmpty(f.url)){var g=findCategory(c,f.url);isNullOrEmpty(g)||(void 0===d[g]&&(d[g]=0),d[g]+=f.price,e+=f.price)}}var h=[];for(curCategory in d)h.push({label:curCategory,y:(100*d[curCategory]/e).toFixed(2)});$('#chartContainerPie').CanvasJSChart({title:{text:'\u0420\u0430\u0441\u0445\u043E\u0434\u044B \u043F\u043E \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F\u043C'},data:[{type:'pie',startAngle:45,showInLegend:'true',legendText:'{label}',indexLabel:'{label} ({y})',yValueFormatString:'0.0',dataPoints:h}]})}function parseDate(b){var c=b.split(' ',3),d=c[0],e=['\u044F\u043D\u0432\u0430\u0440\u044F','\u0444\u0435\u0432\u0440\u0430\u043B\u044F','\u043C\u0430\u0440\u0442\u0430','\u0430\u043F\u0440\u0435\u043B\u044F','\u043C\u0430\u044F','\u0438\u044E\u043D\u044F','\u0438\u044E\u043B\u044F','\u0430\u0432\u0433\u0443\u0441\u0442\u0430','\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F','\u043E\u043A\u0442\u044F\u0431\u0440\u044F','\u043D\u043E\u044F\u0431\u0440\u044F','\u0434\u0435\u043A\u0430\u0431\u0440\u044F'].indexOf(c[1]),a=c[2];return new Date(a,e,d)}function main(){'e-dostavka.by'===window.location.hostname?$('.wrapper').html('<a id=startButton class=ui-button style=font-size:250%;margin:100px;20px; onclick=javascript:buildStat() href=#>\u0421\u043E\u0431\u0440\u0430\u0442\u044C \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0443</a><div id=progresscontainer style=margin:100px;20px;display:none;font-size:14px;><div id=messageBox style=font-size:16px;font-color:#a01919></div><div id=progressbar></div></div><div id=answerContainer style=display:none;><div style=margin:30px;5px;><div id=chartContainer style=height:370px;width:100%;></div></div><div style=margin:30px;5px;><div id=chartContainerPie style=height:370px;width:100%;></div></div><div style=margin:30px;5px;><div style=width:100%;><label for=productDropDown style=min-width:100px;font-size:16px;width:20%;>\u041F\u0440\u043E\u0434\u0443\u043A\u0442: </label><input id=productDropDown style=width:80%;></div><div id=priceChangeChartContainer style=height:370px;width:100%;></div></div></div><script src=https://code.jquery.com/ui/1.12.1/jquery-ui.js></script><script src=https://canvasjs.com/assets/script/jquery.canvasjs.min.js></script>'):alert('\u0421\u043A\u0440\u0438\u043F\u0442 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 \u0442\u043E\u043B\u044C\u043A\u043E \u043D\u0430 e-dostavka.by')}function isNullOrEmpty(a){return void 0===a||''===a}async function buildStat(){$('#progressbar').progressbar({value:0}),$('#progresscontainer').show(),$('#startButton').hide(),$('#messageBox').html('\u0418\u0434\u0435\u0442 \u0441\u0431\u043E\u0440 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0438, \u044D\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043D\u044F\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0438\u043D\u0443\u0442...');var b=[],j=[];const e=await getData('https://e-dostavka.by/cabinet/history/');var k=$('.number a',e),a=k.length;if(0!==a){for(let e=0;e<a;e++){var i=$(k[e]).attr('href');const r=await getData(i);if($('#progressbar').progressbar({value:100*e/a}),0<$('.fa-home',r).length){var n=$('.date_order',r);n.find('b').remove();var o=parseDate(n.text()),l=$('.description',r);for(let a=0;a<l.length;a++){var d=$('.itog',l[a]);d.find('strong').remove(),d.find('b').remove();var c=$('.cent',d).text();d.find('span').remove();var p=d.text(),q=parseFloat(p)+parseFloat(c)/100,h=$('.title',l[a]).text(),g=$('.title a',l[a]).attr('href'),s=$('.row-item',l[a]).filter(function(){return'\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E:'===$('strong',this).text().trim()});s.find('strong').remove(),s.find('span').remove();var f=parseFloat(s.text()),m=$('.row-item',l[a]).filter(function(){return'\u0410\u0440\u0442\u0438\u043A\u0443\u043B:'===$('strong',this).text().trim()});m.find('strong').remove();var u=m.text().trim();if(0===j.filter(a=>a.id===u).length&&!isNullOrEmpty(g)){const a=await getProductInfo(g,u);j.push(a)}b.push({date:o,title:h,url:g,price:q,quantity:f,id:u})}}}$('#progresscontainer').hide(),$('#answerContainer').show(),buildMoneyPerMonthChart(b,j),buildMoneyPerCategory(b,j),buildPriceChangeChart(b,j)}else $('#messageBox').html('\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0438\u0441\u0442\u043E\u0440\u0438\u0438 \u0437\u0430\u043A\u0430\u0437\u043E\u0432 \u0438\u043B\u0438 \u0438\u0441\u0442\u043E\u0440\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u043E\u0432 \u043F\u0443\u0441\u0442\u0430.')}main();" >Перетяни меня в закладки</a>


